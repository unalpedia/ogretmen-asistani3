<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistan Pro V12.4 - GeliÅŸmiÅŸ Raporlama</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f1f5f9; }
        .tab-btn { padding: 10px 16px; border-radius: 14px; font-weight: 800; font-size: 11px; transition: 0.3s; text-transform: uppercase; }
        .active-tab { background: #4338ca; color: white; }
        
        @media print { 
            .no-print { display: none !important; } 
            .print-only { display: block !important; } 
            body { background: white; padding: 0; margin: 0; }
            .page-break { page-break-after: always; border: none !important; }
        }
        .print-only { display: none; }
        .podium-1 { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
        .podium-2 { background: linear-gradient(135deg, #e2e8f0 0%, #94a3b8 100%); }
        .podium-3 { background: linear-gradient(135deg, #ffedd5 0%, #ed8936 100%); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [page, setPage] = useState('dashboard');
            const [classes, setClasses] = useState(() => JSON.parse(localStorage.getItem('ap_v12_cls') || '[]'));
            const [selClass, setSelClass] = useState(null);
            const [students, setStudents] = useState([]);
            const [homeworks, setHomeworks] = useState([]);
            const [exams, setExams] = useState([]);
            const [drawnStudents, setDrawnStudents] = useState([]);
            const [isSpinning, setIsSpinning] = useState(false);
            const [winner, setWinner] = useState(null);
            const [currentFlashName, setCurrentFlashName] = useState("");
            const [detailStudent, setDetailStudent] = useState(null);

            useEffect(() => { localStorage.setItem('ap_v12_cls', JSON.stringify(classes)); }, [classes]);
            
            useEffect(() => {
                if (selClass) {
                    setStudents(JSON.parse(localStorage.getItem(`s12_${selClass.id}`) || '[]'));
                    setHomeworks(JSON.parse(localStorage.getItem(`h12_${selClass.id}`) || '[]'));
                    setExams(JSON.parse(localStorage.getItem(`e12_${selClass.id}`) || '[]'));
                }
            }, [selClass]);

            const saveData = (stds, hws, exms) => {
                if(stds) { setStudents(stds); localStorage.setItem(`s12_${selClass.id}`, JSON.stringify(stds)); }
                if(hws) { setHomeworks(hws); localStorage.setItem(`h12_${selClass.id}`, JSON.stringify(hws)); }
                if(exms) { setExams(exms); localStorage.setItem(`e12_${selClass.id}`, JSON.stringify(exms)); }
            };

            const addLog = (stdId, type, amount, reason) => {
                const updated = students.map(s => {
                    if(s.id === stdId) {
                        const newPuan = (Number(s.puan) || 0) + Number(amount);
                        return { ...s, puan: newPuan, logs: [{ date: new Date().toLocaleString('tr-TR'), type, amount: Number(amount), reason, currentTotal: newPuan }, ...(s.logs || [])] };
                    }
                    return s;
                });
                saveData(updated, null, null);
            };

            const HybridChart = ({ stdId, color = "#4338ca" }) => {
                const sExams = exams.filter(e => e.results?.[stdId]);
                if (sExams.length < 1) return <div className="text-[10px] text-slate-400 italic">Yeterli sÄ±nav verisi yok.</div>;
                
                const width = 400; const height = 120; const padding = 20;
                const points = sExams.map((e, i) => {
                    const net = Number(e.results[stdId].net) || 0;
                    const x = padding + (i * (width - 2 * padding) / (sExams.length > 1 ? sExams.length - 1 : 1));
                    const y = height - padding - ((net / (e.qCount || 100)) * (height - 2 * padding));
                    return { x, y, net };
                });

                return (
                    <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
                        <path d={`M ${points.map(p => `${p.x},${p.y}`).join(' L ')}`} fill="none" stroke={color} strokeWidth="3" strokeLinejoin="round" />
                        {points.map((p, i) => <circle key={i} cx={p.x} cy={p.y} r="4" fill={color} />)}
                    </svg>
                );
            };

            return (
                <div className="min-h-screen">
                    <nav className="bg-slate-900 text-white p-5 flex justify-between items-center no-print">
                        <h1 onClick={()=>{setPage('dashboard'); setSelClass(null)}} className="text-xl font-black cursor-pointer italic uppercase">Asistan <span className="text-indigo-400">Pro V12.4</span></h1>
                        {selClass && <span className="bg-indigo-600 px-4 py-1 rounded-lg text-xs font-bold uppercase">{selClass.name}</span>}
                    </nav>

                    <main className="p-6 max-w-7xl mx-auto">
                        {page === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 pt-10">
                                <button onClick={()=>{const n=prompt("SÄ±nÄ±f AdÄ±:"); if(n)setClasses([...classes,{id:Date.now(),name:n}])}} className="h-44 border-4 border-dashed border-slate-300 rounded-[2.5rem] font-black text-slate-400 hover:text-indigo-600 transition-all uppercase">+ Yeni SÄ±nÄ±f</button>
                                {classes.map(c => (
                                    <div key={c.id} onClick={()=>{setSelClass(c); setPage('list')}} className="bg-white p-10 rounded-[2.5rem] shadow-xl border-b-8 border-indigo-600 hover:-translate-y-2 transition-all cursor-pointer">
                                        <h3 className="text-3xl font-black text-slate-800 italic uppercase">{c.name}</h3>
                                    </div>
                                ))}
                            </div>
                        )}

                        {selClass && (
                            <div className="space-y-6 no-print">
                                <div className="flex flex-wrap gap-2 p-2 bg-white rounded-2xl w-fit shadow-sm border mx-auto md:mx-0">
                                    {['list','hw','exam','rank','reports'].map(t => (
                                        <button key={t} onClick={()=>setPage(t)} className={`tab-btn ${page===t?'active-tab':'text-slate-400'}`}>
                                            {t==='list'?'Ã–ÄŸrenci':t==='hw'?'Ã–dev':t==='exam'?'SÄ±nav':t==='rank'?'Skor':'Raporlar'}
                                        </button>
                                    ))}
                                </div>

                                {page === 'reports' && (
                                    <div className="bg-white rounded-[2.5rem] p-10 shadow-2xl">
                                        <div className="flex justify-between items-center mb-10">
                                            <div>
                                                <h2 className="text-3xl font-black uppercase italic">Veli Bilgilendirme Merkezi</h2>
                                                <p className="text-slate-400 font-bold">Her Ã¶ÄŸrenci iÃ§in otomatik performans sayfasÄ± hazÄ±rlanÄ±r.</p>
                                            </div>
                                            <button onClick={() => window.print()} className="bg-emerald-500 text-white px-8 py-4 rounded-2xl font-black uppercase italic shadow-lg hover:bg-emerald-600 transition-all">
                                                ğŸ–¨ï¸ Ã‡Ä±ktÄ± Al (TÃ¼m SÄ±nÄ±f)
                                            </button>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {students.map(s => (
                                                <div key={s.id} className="p-4 border-2 rounded-2xl flex justify-between items-center bg-slate-50">
                                                    <span className="font-black uppercase italic">{s.name}</span>
                                                    <span className="text-emerald-500 font-bold text-xs uppercase">Rapor HazÄ±r</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* DiÄŸer sayfalar buraya gelecek (Mevcut kodunuzdaki List, Hw, Exam kÄ±sÄ±mlarÄ±) */}
                                {page === 'list' && <div className="bg-white p-10 rounded-3xl shadow-xl font-bold italic text-slate-400">Ã–ÄŸrenci listesi ve diÄŸer modÃ¼ller aktif. Rapor sekmesini kontrol edin.</div>}
                            </div>
                        )}
                    </main>

                    {/* PROFESYONEL VELÄ° Ã‡IKTI ÅABLONU */}
                    <div className="print-only">
                        {students.map((s) => {
                            const sExams = exams.filter(e => e.results?.[s.id]);
                            const lastExam = sExams[sExams.length - 1];
                            const prevExam = sExams[sExams.length - 2];
                            const trend = lastExam && prevExam ? (lastExam.results[s.id].net >= prevExam.results[s.id].net ? 'YÃœKSELÄ°ÅTE ğŸ“ˆ' : 'DÃœÅÃœÅTE ğŸ“‰') : 'Ä°LK VERÄ°';

                            return (
                                <div key={s.id} className="page-break p-12 border-[16px] border-slate-100 min-h-screen relative">
                                    <div className="flex justify-between items-start border-b-4 border-indigo-600 pb-8 mb-10">
                                        <div>
                                            <h1 className="text-5xl font-black uppercase italic text-slate-900">{s.name}</h1>
                                            <p className="text-indigo-600 font-black tracking-widest mt-2">{selClass?.name} - Ã–ÄRENCÄ° PERFORMANS RAPORU</p>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-4xl font-black text-indigo-600 italic">{s.puan} PUAN</div>
                                            <p className="text-xs font-bold text-slate-400 mt-1 uppercase italic">{new Date().toLocaleDateString('tr-TR')} TARÄ°HLÄ° ANALÄ°Z</p>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-12">
                                        <div className="space-y-10">
                                            <section>
                                                <h3 className="text-xs font-black text-slate-400 uppercase mb-4 tracking-tighter">ğŸ“Š SINAV BAÅARI GRAFÄ°ÄÄ° (NET)</h3>
                                                <div className="bg-slate-50 p-6 rounded-3xl border-2 border-slate-100">
                                                    <HybridChart stdId={s.id} />
                                                    <div className="mt-6 flex justify-between items-center bg-white p-3 rounded-xl border">
                                                        <span className="text-[10px] font-black uppercase text-slate-500">GeliÅŸim EÄŸilimi:</span>
                                                        <span className="font-black italic text-indigo-600 text-sm">{trend}</span>
                                                    </div>
                                                </div>
                                            </section>

                                            <section>
                                                <h3 className="text-xs font-black text-slate-400 uppercase mb-4 tracking-tighter">âœ… Ã–DEV TAKÄ°P VERÄ°LERÄ°</h3>
                                                <div className="space-y-2">
                                                    {homeworks.slice(-6).map(h => (
                                                        <div key={h.id} className="flex justify-between items-center p-3 bg-slate-50 rounded-xl border-l-4 border-indigo-400">
                                                            <span className="text-[10px] font-bold uppercase truncate w-40">{h.title}</span>
                                                            <span className="text-[10px] font-black italic uppercase">
                                                                {h.results?.[s.id] === 'done' ? 'âœ… TAMAM' : h.results?.[s.id] === 'partial' ? 'âš ï¸ EKSÄ°K' : 'âŒ YAPILMADI'}
                                                            </span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </section>
                                        </div>

                                        <div className="space-y-10">
                                            <section>
                                                <h3 className="text-xs font-black text-slate-400 uppercase mb-4 tracking-tighter">ğŸ“ SON SINAV SONUÃ‡LARI</h3>
                                                <table className="w-full text-left">
                                                    <thead>
                                                        <tr className="text-[10px] text-slate-400 border-b">
                                                            <th className="pb-2">SINAV</th>
                                                            <th className="pb-2">D/Y</th>
                                                            <th className="pb-2 text-right">NET</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="text-[11px] font-bold uppercase">
                                                        {sExams.slice(-8).reverse().map(e => (
                                                            <tr key={e.id} className="border-b">
                                                                <td className="py-2 text-slate-700">{e.title}</td>
                                                                <td className="py-2 text-slate-500">{e.results[s.id].d}D - {e.results[s.id].y}Y</td>
                                                                <td className="py-2 text-right text-indigo-600 font-black">{Number(e.results[s.id].net).toFixed(2)}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </section>

                                            <section className="bg-slate-900 text-white p-8 rounded-[3rem]">
                                                <h3 className="text-xs font-black text-indigo-400 uppercase mb-4">ğŸ‘¨â€ğŸ« Ã–ÄRETMEN GÃ–RÃœÅÃœ</h3>
                                                <div className="h-24 border-b border-slate-700 border-dashed mb-4"></div>
                                                <p className="text-[9px] font-medium text-slate-500 italic uppercase italic">Bu rapor Asistan Pro V12.4 akÄ±llÄ± takip sistemi tarafÄ±ndan Ã¶ÄŸrencinin tÃ¼m aktiviteleri analiz edilerek oluÅŸturulmuÅŸtur.</p>
                                            </section>
                                        </div>
                                    </div>

                                    <div className="absolute bottom-12 left-12 right-12 flex justify-between items-center pt-8 border-t border-slate-100 opacity-30">
                                        <span className="font-black italic text-xs uppercase tracking-widest">Asistan Pro V12.4</span>
                                        <span className="text-[10px] font-bold uppercase italic italic">Ã–ÄRENCÄ° TAKÄ°P VE ANALÄ°Z SÄ°STEMÄ°</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
